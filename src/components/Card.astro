---
import { parseTitle, toNumericUrl } from '@/util';

export interface Props {
  post: {
    url: string;
    frontmatter: {
      image: string;
      description: string;
      date: string;
      legacySlug?: string;
      issueTitle?: string;
      numericUrl?: string;
    };
  };
  priority?: boolean;
  isLCP?: boolean;
}

const { post, priority = false, isLCP = false } = Astro.props;
import { getLangFromUrl } from '../i18n/utils';
const lang = getLangFromUrl(Astro.url);

const legacySlug = post.frontmatter?.legacySlug;
const issueTitle = post.frontmatter?.issueTitle;
const link = post.frontmatter?.numericUrl ?? toNumericUrl(post.url);
const title = parseTitle(link, legacySlug, issueTitle, lang);
const { image, description, date } = post.frontmatter;
---

<a
  href={link}
  data-astro-prefetch
  data-image={image}
  class='pb-3 md:mt-5 mt-4 md:mr-4 flex flex-col justify-center rounded-lg shadow-md overflow-hidden mx-auto md:w-80 sm:w-96 w-full card-content preload-link'
  style='transition: all 200ms ease; will-change: transform;'
>
  <img
    src={`${image}?x-oss-process=image/resize,w_640/format,webp`}
    width='640'
    height='384'
    alt={title}
    loading={priority ? 'eager' : 'lazy'}
    decoding='async'
    fetchpriority={isLCP ? 'high' : 'auto'}
    class='block md:w-80 md:h-48 sm:w-96 w-full sm:h-52 h-56 rounded-t-lg'
    style='transition: transform 200ms ease;'
  />
  <div class='w-full flex justify-between items-center leading-tight pt-3 px-3'>
    <div
      class='text-gray-800 dark:text-gray-200 font-semibold md:text-base text-lg overflow-hidden text-ellipsis whitespace-nowrap flex-1 mr-2 min-w-0'
    >
      {title}
    </div>
    <div class='text-grey-darker text-gray-600 dark:text-gray-300 md:text-sm text-base flex-shrink-0'>
      {date}
    </div>
  </div>
  <p class='text-gray-600 dark:text-gray-300 md:w-78 w-94 overflow-hidden pt-2 line-clamp-2 px-3 w-full md:h-12 h-14 md:text-sm text-base'>
    {description}
  </p>
</a>
